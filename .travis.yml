language: c

matrix:
  include:
    - env: JOB=hstox ENV=linux
      language: haskell
      ghc: 7.8
    - env: JOB=autotools ENV=linux
      compiler: gcc
    - env: JOB=toxcore ENV=linux
      compiler: clang
    - env: JOB=toxcore ENV=osx
      os: osx
    - env: JOB=toxcore ENV=windows
      services:
        - docker

addons:
  apt:
    sources:
      - avsm
    packages:
      - check
      - libvpx-dev
      - opam            # For apidsl and Frama-C.
      - texinfo         # For libconfig.

cache:
  directories:
    # Although Travis documentation says not to rely on the value of $HOME, we
    # rely on it here because cabal installs its packages there by default. If
    # that ever changes, these values need to be updated.
    # Note that we can't use shell expressions in these paths, so we can't ask
    # cabal where its data is stored.
    - $HOME/.cabal
    - $HOME/.ghc
    - $HOME/cache

install:       other/travis/phase $JOB $ENV install
script:        other/travis/phase $JOB $ENV script
after_script:  other/travis/phase $JOB $ENV after_script
after_failure: other/travis/phase $JOB $ENV after_failure

notifications:
  irc: "chat.freenode.net#toktok-status"

branches:
  only:
    - master
